<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-time Log Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
    <style>
        body {
            font-family: sans-serif;
            /* 使用黑体 */
            background: radial-gradient(#ffffff, #4a5856);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            overflow: hidden;
        }

        #log-container {
            width: 90%;
            max-width: 1000px;
            background: rgba(255, 255, 255, 0.4);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            margin: 20px;
            backdrop-filter: blur(10px);
            /* 毛玻璃效果 */
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        #log {
            font-family: "Helvetica", "Arial", sans-serif;
            font-size: 12px;
            /* 确保日志区使用无衬线字体 */
            white-space: pre-wrap;
            /* 保留空格和换行符 */
            max-height: 60vh;
            overflow-y: auto;
            padding: 10px;
            animation: fadeIn 1s ease-in-out;
            /* 动效刷新 */
            scroll-behavior: smooth; /* 添加平滑滚动 */
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.4), 0 0 10px rgba(255, 255, 255, 0.2)
        }

        pre {
            font-family: sans-serif;
            font-size: 12px;
            unicode-bidi: isolate;
            white-space: pre-wrap;
            margin: 1em 0px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .divider {
            border-top: 2px solid #000;
            margin: 10px 0;
        }

        #clock {
            font-family: "Helvetica", "Arial", sans-serif;
            /* 确保时钟元素使用无衬线字体 */
            font-size: 20px;
            margin-bottom: 20px;
            position: fixed;
            bottom: 50px;
            right: 10px;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            z-index: 1000;
            /* 确保在最上层 */
            backdrop-filter: blur(0.7px);
            /* 毛玻璃效果 */
            -webkit-backdrop-filter: blur(2px);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            cursor: move;
        }
    </style>
</head>

<body>
    <div id="clock"></div> <!-- 电子钟元素 -->
    <div id="log-container">
        <h1>Real-time Log Viewer</h1>
        <div id="log"></div>
    </div>

    <script type="text/javascript">
        // 实时更新电子钟
        function updateClock() {
            var now = new Date();
            var hours = now.getHours().toString().padStart(2, '0');
            var minutes = now.getMinutes().toString().padStart(2, '0');
            var seconds = now.getSeconds().toString().padStart(2, '0');
            var currentTime = `${hours}:${minutes}:${seconds}`;
            document.getElementById('clock').textContent = currentTime;
        }

        setInterval(updateClock, 1000); // 每秒更新一次

        var socket = io();
        var logDiv = document.getElementById('log');

        // 处理日志更新
        socket.on('log_update', function (msg) {
            var newLog = document.createElement('pre');
            newLog.textContent = msg.timestamp ? `[${msg.timestamp}] ${msg.data}` : msg.data;
            newLog.style.animation = 'fadeIn 1s ease-in-out'; // 动效刷新
            logDiv.appendChild(newLog);
            logDiv.scrollTop = logDiv.scrollHeight;
        });

        // 初次调用以便立即显示时间
        updateClock();

        // 使时钟可拖动
        function makeClockDraggable() {
            var clock = document.getElementById('clock');
            var offsetX = 0, offsetY = 0, mouseX = 0, mouseY = 0;

            clock.addEventListener('mousedown', startDrag);
            clock.addEventListener('touchstart', startDrag);

            function startDrag(e) {
                e.preventDefault();
                if (e.type === 'mousedown') {
                    mouseX = e.clientX;
                    mouseY = e.clientY;
                    document.addEventListener('mousemove', moveClock);
                    document.addEventListener('mouseup', stopMovingClock);
                } else if (e.type === 'touchstart') {
                    mouseX = e.touches[0].clientX;
                    mouseY = e.touches[0].clientY;
                    document.addEventListener('touchmove', moveClock);
                    document.addEventListener('touchend', stopMovingClock);
                }
            }

            function moveClock(e) {
                e.preventDefault();
                if (e.type === 'mousemove') {
                    offsetX = mouseX - e.clientX;
                    offsetY = mouseY - e.clientY;
                    mouseX = e.clientX;
                    mouseY = e.clientY;
                } else if (e.type === 'touchmove') {
                    offsetX = mouseX - e.touches[0].clientX;
                    offsetY = mouseY - e.touches[0].clientY;
                    mouseX = e.touches[0].clientX;
                    mouseY = e.touches[0].clientY;
                }

                var rect = clock.getBoundingClientRect();
                var newLeft = rect.left - offsetX;
                var newTop = rect.top - offsetY;

                // 限制时钟在窗口内移动
                if (newLeft < 0) newLeft = 0;
                if (newTop < 0) newTop = 0;
                if (newLeft + rect.width > window.innerWidth) newLeft = window.innerWidth - rect.width;
                if (newTop + rect.height > window.innerHeight) newTop = window.innerHeight - rect.height;

                clock.style.left = newLeft + 'px';
                clock.style.top = newTop + 'px';
                clock.style.right = 'auto';
                clock.style.bottom = 'auto';
            }

            function stopMovingClock() {
                document.removeEventListener('mousemove', moveClock);
                document.removeEventListener('mouseup', stopMovingClock);
                document.removeEventListener('touchmove', moveClock);
                document.removeEventListener('touchend', stopMovingClock);
            }
        }

        document.getElementById('clock').style.position = 'fixed';
        document.getElementById('clock').style.bottom = '50px';
        document.getElementById('clock').style.right = '10px';
        makeClockDraggable();
    </script>
</body>

</html>